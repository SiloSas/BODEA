<div class="column large-12 table-title-container">
    <div class="column medium-2 table-title">
        <div class="column md-whiteframe-z1">
            Numero
            <i class="fa"
              ng-class="{'fa-chevron-down': predicate != 'id' || (predicate == 'id' && reverse == false),
              'fa-chevron-up': predicate == 'id' && reverse == true}"
              ng-click="order('id')"></i>
        </div>
    </div>
    <div class="column medium-2 table-title">
        <div class="column md-whiteframe-z1">
            Enseigne
            <i class="fa"
               ng-class="{'fa-chevron-down': predicate != 'brand.name' || (predicate == 'brand.name' && reverse == false),
              'fa-chevron-up': predicate == 'brand.name' && reverse == true}"
               ng-click="order('brand.name')"></i>
        </div>
    </div>
    <div class="column medium-2 table-title">
        <div class="column md-whiteframe-z1">
            Date
            <i class="fa"
               ng-class="{'fa-chevron-down': predicate != 'date' || (predicate == 'date' && reverse == false),
              'fa-chevron-up': predicate == 'date' && reverse == true}"
               ng-click="order('date')"></i>
        </div>
    </div>
    <div class="column medium-2 table-title">
        <div class="column md-whiteframe-z1">
            Etat
            <i class="fa"
               ng-class="{'fa-chevron-down': predicate != 'state' || (predicate == 'state' && reverse == false),
              'fa-chevron-up': predicate == 'state' && reverse == true}"
               ng-click="order('state')"></i>
        </div>
    </div>
    <md-button class="md-primary md-raised column medium-4 marginLeft0 marginRight0"
               ng-click="createOrder = true">Ajouter une commande
    </md-button>
</div>
<md-list ng-if="createOrder" class="md-whiteframe-z1">
    <form ng-submit="addOrder(); $parent.createOrder = false">
        <i class="md-warn relative fa fa-times-circle"
           style="  font-size: 30px;right: -15px;float: right;top: -22px;"
           ng-click="$parent.createOrder = false"></i>
        <md-subheader>Ajouter une commande</md-subheader>
        <md-divider></md-divider>
        <md-autocomplete flex required
                         md-autofocus="false"
                         md-no-cache="noCache"
                         md-selected-item="newOrder.brand"
                         md-search-text-change="searchTextChange(searchBrand)"
                         md-search-text="searchBrand"
                         md-selected-item-change="selectedBrandChange(brand)"
                         md-items="brand in querySearchBrand(searchBrand)"
                         md-item-text="brand.name"
                         md-floating-label="Enseigne (cliquez pour valider votre choix)">
            <md-item-template>
                <span md-highlight-text="searchBrand" md-highlight-flags="^i">{{brand.name}}</span>
            </md-item-template>
            <md-not-found>
                No matches found for "{{searchBrand}}".
            </md-not-found>
        </md-autocomplete>
        <md-input-container class="column large-4">
            <label>Numéro de la commande</label>
            <input type="text" ng-model="newOrder.id">
        </md-input-container>
        <md-input-container class="column large-4">
            <label>Référence de la commande</label>
            <input type="text" ng-model="newOrder.ref">
        </md-input-container>
        <md-input-container>
            <label>Date de livraison (JJ/MM/AAAA)</label>
            <input type="date" ng-model="newOrder.deliveryDate">
        </md-input-container>
        <md-list>
            <md-subheader>Prix total</md-subheader>
            <md-divider></md-divider>
            <md-list-item>
                <b>{{order.price}} €</b>
            </md-list-item>
        </md-list>
        <md-list>
            <md-subheader>Nombre total de baches</md-subheader>
            <md-divider></md-divider>
            <md-list-item>
                <b>{{order.numberItems}}</b>
            </md-list-item>
        </md-list>
        <md-list>
            <md-subheader>Poid total</md-subheader>
            <md-divider></md-divider>
            <md-list-item>
                <b>{{order.weight}}</b>
            </md-list-item>
        </md-list>
        <md-list>
            <md-subheader>Etat :</md-subheader>
            <md-divider></md-divider>
            <md-list-item>
                <md-radio-group ng-model="newOrder.state">
                    <md-radio-button value="1" class="md-accent marginLeft0">Commande en préparation</md-radio-button>
                    <md-radio-button value="2" class="md-accent md-hue-1 marginLeft0"> Commande validée </md-radio-button>
                    <md-radio-button value="3" class="md-accent md-hue-2 marginLeft0">En cours de traitement</md-radio-button>
                    <md-radio-button value="4" class="md-primary marginLeft0">En cours de livraison</md-radio-button>
                    <md-radio-button value="5" class="md-accent md-hue-3 marginLeft0">Livré</md-radio-button>
                </md-radio-group>
            </md-list-item>
        </md-list>
        <md-list>
            <md-subheader>Visuel</md-subheader>
            <md-divider></md-divider>
            <md-list-item>
                <div class="column large-12 padding0">
                    <input type="file"
                           class="md-button md-primary md-default-theme"
                           ng-change="addImg()"
                           ng-model="newOrder.image.url" app-filereader>
                    <div class="column large-12 md-whiteframe-z1 padding10" ng-if="newOrder.image.url">
                        <i class="float-right fa fa-times pointer" ng-click="newOrder.image = {}"></i>
                        <img ng-src="{{newOrder.image.url}}" class="width100p">
                    </div>
                </div>
            </md-list-item>
        </md-list>
        <md-subheader class="md-no-sticky">Details de la commande</md-subheader>
        <md-list ng-repeat="subOrder in newOrder.subOrders">
            <md-divider></md-divider>
            <md-input-container>
                <label>Magasin</label>
                <input type="text" ng-model="subOrder.store.name">
            </md-input-container>
            <md-input-container>
                <label>Adresse de livraison</label>
                <input type="text" ng-model="subOrder.store.deliveryAddress">
            </md-input-container>
            <md-input-container>
                <label>Nombre de bâches</label>
                <input type="text" ng-model="subOrder.numberItems">
            </md-input-container>
            <md-input-container>
                <label>Prix</label>
                <input type="text" ng-model="subOrder.price">
            </md-input-container>
            <md-input-container>
                <label>Poids</label>
                <input type="text" ng-model="subOrder.weight">
            </md-input-container>
        </md-list>
        <md-list>
            <md-subheader class="md-no-sticky">Ajouter une sous commande</md-subheader>
            <md-divider></md-divider>
            <form>
                <div ng-show="newOrder.brand">
                    <md-subheader class="md-no-sticky">Choisissez un magasin</md-subheader>
                    <md-divider></md-divider>
                    <md-radio-group ng-change="newSubOrder.store = parseJson(selectedStore);
                    viewStoreDetail = false"
                            ng-model="selectedStore">
                        <md-radio-button ng-repeat="store in filtredStores =(stores | filter: newOrder.brand.name)"
                                         value="{{store}}"
                                         class="md-primary">{{store.name}}</md-radio-button>
                    </md-radio-group>
                    <a class="md-button md-primary md-raised md-default-theme"
                       ng-show="selectedStore.length > 0 && !viewStoreDetail"
                       ng-click="copyStore(newSubOrder.store); viewStoreDetail = true;
                       createStore = false">
                        Voir / modifier les details du magasin
                    </a>
                    <a class="md-button md-primary md-raised md-default-theme"
                       ng-show="!viewStoreDetail"
                       ng-click="newSubOrder.store.newStore = {};
                       viewStoreDetail = true; selectedStore = false; createStore = true">
                        Ajouter un magasin
                    </a>
                    <a class="md-button md-primary md-raised md-default-theme"
                       ng-show="viewStoreDetail"
                       ng-click="removeCopyStore(newSubOrder.store); viewStoreDetail = false">
                        Cacher les details du magasin
                    </a>
                </div>
                <div ng-show="viewStoreDetail">
                    <md-input-container>
                        <label>Nom du magasin</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.name">
                    </md-input-container>
                    <md-input-container>
                        <label>Référent</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.contactName">
                    </md-input-container>
                    <md-input-container>
                        <label>Adresse de livraison</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.deliveryAddress">
                    </md-input-container>
                    <md-input-container>
                        <label>Adresse de facturation</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.billingAddress">
                    </md-input-container>
                    <md-autocomplete flex required
                                     md-autofocus="false"
                                     md-no-cache="noCache"
                                     md-selected-item="newSubOrder.store.newStore.area"
                                     md-search-text-change="searchTextChange(searchArea)"
                                     md-search-text="searchArea"
                                     md-selected-item-change="selectedItemChange(area)"
                                     md-items="area in querySearch(searchArea)"
                                     md-item-text="area.name"
                                     md-floating-label="Région (cliquez pour valider votre choix)">
                        <md-item-template>
                            <span md-highlight-text="searchArea" md-highlight-flags="^i">{{area.name}}</span>
                        </md-item-template>
                        <md-not-found>
                            No matches found for "{{searchArea}}".
                        </md-not-found>
                    </md-autocomplete>
                    <md-input-container>
                        <label>Numero de téléphone</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.phone">
                    </md-input-container>
                    <md-input-container>
                        <label>Prix d'une bâche (prix m2)</label>
                        <input type="number" step="any" ng-model="newSubOrder.store.newStore.priceByM2">
                    </md-input-container>
                    <md-input-container>
                        <label>Longueur du tube</label>
                        <input type="number" step="any" ng-model="newSubOrder.store.newStore.pipeSize">
                    </md-input-container>
                    <md-input-container>
                        <label>Poid de la bache</label>
                        <input type="number" step="any" ng-model="newSubOrder.store.newStore.weight">
                    </md-input-container>
                    <md-input-container>
                        <label>Format d'impression</label>
                        <input type="text" ng-model="newSubOrder.store.newStore.printFormat">
                    </md-input-container>
                    <md-input-container>
                        <label>Laize utilisé</label>
                        <input type="number" step="any" ng-model="newSubOrder.store.newStore.width">
                    </md-input-container>
                    <md-input-container>
                        <label>Longueur du jonc</label>
                        <input type="number" step="any" ng-model="newSubOrder.store.newStore.caneWidth">
                    </md-input-container>
                    <md-input-container>
                        <label>Nombre de moteurs</label>
                        <input type="number" ng-model="newSubOrder.store.newStore.enginesNumber">
                    </md-input-container>
                    <a class="md-button md-primary md-raised md-default-theme"
                       ng-show="createStore == false"
                       ng-click="refactorStore(newSubOrder.store); viewStoreDetail = false">
                        Valider
                    </a>
                    <a class="md-button md-primary md-raised md-default-theme"
                       ng-show="createStore == true"
                       ng-click="addNewStore(newSubOrder.store); viewStoreDetail = false">
                        Créer
                    </a>
                    <a class="md-button md-warn md-raised md-default-theme"
                       ng-click="removeCopyStore(newSubOrder.store); viewStoreDetail = false">
                        Annuler
                    </a>
                </div>
                <md-input-container>
                    <label>Nombre de bâches</label>
                    <input type="text" ng-model="newSubOrder.numberItems">
                </md-input-container>
                <md-input-container>
                    <label>Prix</label>
                    <input type="text" ng-model="newSubOrder.price">
                </md-input-container>
                <md-input-container>
                    <label>Poids</label>
                    <input type="text" ng-model="newSubOrder.weight">
                </md-input-container>
                <a class="md-button md-raised md-default-theme md-primary"
                   ng-click="addNewSubOrder()">
                    Ajouter la sous commande
                </a>
            </form>
        </md-list>
        <md-button class="md-primary md-raised" type="submit">Valider</md-button>
        <md-button class="md-warn md-raised" ng-click="$parent.createOrder = false">Annuler</md-button>
    </form>
</md-list>
<div class="column large-12" md-theme="commandeTheme"
     ng-repeat="order in filteredOrders = (orders | filter: filter) | orderBy:predicate:reverse | limitTo: limit">
    <md-divider class="column large-12" ng-if="!$first"></md-divider>
    <div class="padding10 float-left width100p">
        <div class="width100p float-left center" ng-show="!refactor">
            <h5 class="column medium-2">{{order.id}}</h5>
            <h5 class="column medium-2">{{order.brand.name}}</h5>
            <h5 class="column medium-2">{{order.date}}</h5>
            <div class="column medium-2">
                <md-button class="md-fab md-mini"
                           aria-label=" order.state"
                        ng-class="{'md-accent': order.state == 1, 'md-accent md-hue-1': order.state == 2,
                        'md-accent md-hue-2': order.state == 3, 'md-primary': order.state == 4,
                        'md-accent md-hue-3': order.state == 5}"></md-button></div>
            <h5><i class="column medium-2 pointer fa fa-pencil"
               ng-click="copyCommande(order); refactor = true"></i></h5>
            <h5><i class="column medium-2 pointer fa fa-trash" ng-click="confirmRemove = !confirmRemove"></i></h5>
        </div>
        <div ng-if="confirmRemove" class="float-right md-whiteframe-z1">
           <div class="float-left padding10">
               Etes-vous sur de vouloir suprimer cette commande ?
            <md-button class="md-primary md-raised" ng-click="$parent.confirmRemove = false; remove($index)">
                Oui
            </md-button>
            <md-button class="md-primary md-raised" ng-click="$parent.confirmRemove = false">
                Non
            </md-button>
           </div>
        </div>
        <md-list ng-if="refactor" class="md-whiteframe-z1">
            <form ng-submit="refactorCommande($parent.order); $parent.order = order.newOrder; $parent.refactor = false">
                <i class="md-warn relative fa fa-times-circle"
                   style="  font-size: 30px;right: -15px;float: right;top: -22px;"
                   ng-click="$parent.refactor = false"></i>
                <md-subheader>Modifer la commande {{order.id}} - {{order.brand}}</md-subheader>
                <md-divider></md-divider>
                <md-input-container class="column large-4">
                    <label>Numéro de la commande</label>
                    <input type="text" ng-model="order.newOrder.id">
                </md-input-container>
                <md-input-container class="column large-4">
                    <label>Référence de la commande</label>
                    <input type="text" ng-model="order.newOrder.ref">
                </md-input-container>
                <md-input-container>
                    <label>Date de livraison (JJ/MM/AAAA)</label>
                    <input type="date" ng-model="order.newOrder.deliveryDate">
                </md-input-container>
                <md-list>
                    <md-subheader>Prix total</md-subheader>
                    <md-divider></md-divider>
                    <md-list-item>
                        <b>{{order.price}} €</b>
                    </md-list-item>
                </md-list>
                <md-list>
                    <md-subheader>Nombre total de baches</md-subheader>
                    <md-divider></md-divider>
                    <md-list-item>
                        <b>{{order.numberItems}}</b>
                    </md-list-item>
                </md-list>
                <md-list>
                    <md-subheader>Poid total</md-subheader>
                    <md-divider></md-divider>
                    <md-list-item>
                        <b>{{order.weight}}</b>
                    </md-list-item>
                </md-list>
                <md-list>
                    <md-subheader>Etat :</md-subheader>
                    <md-divider></md-divider>
                    <md-list-item>
                        <md-radio-group ng-model="order.newOrder.state">
                            <md-radio-button value="1" class="md-accent marginLeft0">Commande en préparation</md-radio-button>
                            <md-radio-button value="2" class="md-accent md-hue-1 marginLeft0"> Commande validée </md-radio-button>
                            <md-radio-button value="3" class="md-accent md-hue-2 marginLeft0">En cours de traitement</md-radio-button>
                            <md-radio-button value="4" class="md-primary marginLeft0">En cours de livraison</md-radio-button>
                            <md-radio-button value="5" class="md-accent md-hue-3 marginLeft0">Livré</md-radio-button>
                        </md-radio-group>
                    </md-list-item>
                </md-list>
                <md-list>
                    <md-subheader>Visuel</md-subheader>
                    <md-divider></md-divider>
                    <md-list-item>
                        <div class="column large-12 padding0">
                            <a class="md-primary md-button margin10 md-default-theme" ng-click="showImage = !showImage">Voir {{order.image.name}}</a>
                            <a class="md-primary md-button margin10 md-default-theme" href="{{order.image.url}}" download="{{order.image.name}}">Telecharger {{order.image.name}}</a>
                            <div class="column large-12 md-whiteframe-z1 padding10" ng-if="showImage">
                                <i class="float-right fa fa-times pointer" ng-click="$parent.showImage = false"></i>
                                <img ng-src="{{order.image.url}}" class="width100p">
                            </div>
                        </div>
                    </md-list-item>
                </md-list>
                <md-subheader class="md-no-sticky">Details de la commande</md-subheader>
                <md-list ng-repeat="subOrder in order.subOrders">
                    <md-divider></md-divider>
                    <md-list-item>
                        <p class="column medium-4">Magasin</p>
                        <p>{{subOrder.store.name}}</p>
                    </md-list-item>
                    <md-list-item>
                        <p class="column medium-4">Adresse de livraison</p>
                        <p>{{subOrder.store.deliveryAddress}}</p>
                    </md-list-item>
                    <md-list-item>
                        <p class="column medium-4">Nombre de bâches</p>
                        <p>{{subOrder.numberItems}}</p>
                    </md-list-item>
                    <md-list-item>
                        <p class="column medium-4">Prix</p>
                        <p>{{subOrder.price}} €</p>
                    </md-list-item>
                    <md-list-item>
                        <p class="column medium-4">Poids</p>
                        <p>{{subOrder.weight}} kg</p>
                    </md-list-item>
                    <md-list-item ng-if="order.newOrder.state != 1 && order.newOrder.state != 2">
                        <p class="column medium-4">Livré</p>
                        <md-switch class="md-accent md-hue-3"
                                   ng-change="changeState($parent.order)"
                                   ng-model="subOrder.delivered"></md-switch>
                    </md-list-item>
                </md-list>
                <md-button class="md-primary md-raised" type="submit">Valider</md-button>
                <md-button class="md-warn md-raised" ng-click="$parent.refactor = false">Annuler</md-button>
            </form>
        </md-list>
    </div>
</div>
<md-button ng-show="filteredOrders.length > limit"
           ng-click="limit = limit + 20"
        class="md-primary md-raised">Voir plus</md-button>

